<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Results - Nextpulse</title>
  <link rel="stylesheet" href="../../styles.css">
  <link rel="stylesheet" href="../quiz-styles.css">
  <link rel="stylesheet" href="brain-styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="../../access-control.js"></script>
  <script src="../../block.js"></script>
  <script src="../../error-handler/link-checker.js"></script>
  <style>
    .results-container {
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .results-card {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .results-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .results-icon.good {
      color: #38a169;
    }

    .results-icon.average {
      color: #ed8936;
    }

    .results-icon.poor {
      color: #e53e3e;
    }

    .results-title {
      font-size: 1.5rem;
      color: #2d3748;
      margin-bottom: 0.5rem;
    }

    .results-score {
      font-size: 3rem;
      font-weight: 700;
      color: #2c5282;
      margin: 1rem 0;
    }

    .results-percentage {
      font-size: 1.25rem;
      color: #718096;
      margin-bottom: 1.5rem;
    }

    .results-message {
      font-size: 1rem;
      color: #4a5568;
      margin-bottom: 2rem;
      padding: 1rem;
      background: #f7fafc;
      border-radius: 8px;
    }

    .results-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .action-btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .action-btn.primary {
      background: #2c5282;
      color: white;
    }

    .action-btn.primary:hover {
      background: #1a365d;
    }

    .action-btn.secondary {
      background: #e2e8f0;
      color: #2d3748;
    }

    .action-btn.secondary:hover {
      background: #cbd5e0;
    }

    .review-list {
      margin-top: 2rem;
      text-align: left;
    }

    .review-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: #f7fafc;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .review-item:hover {
      background: #e2e8f0;
    }

    .review-item.correct {
      border-left: 4px solid #38a169;
    }

    .review-item.incorrect {
      border-left: 4px solid #e53e3e;
    }

    .review-number {
      font-weight: 600;
      color: #2d3748;
      min-width: 30px;
    }

    .review-status i {
      font-size: 1.2rem;
    }

    .review-status.correct i {
      color: #38a169;
    }

    .review-status.incorrect i {
      color: #e53e3e;
    }
  </style>
</head>
<body>
  <script>
    if (!accessControl.initProtectedPage()) {
      throw new Error('Access denied - redirecting to index.html');
    }
  </script>
  
  <header>
    <div class="header-content">
      <button onclick="goBack()" class="back-button" style="display: block;">
        <i class="fas fa-arrow-left"></i>
      </button>
      <h1 id="pageTitle">Quiz Results</h1>
      <p class="header-subtitle" id="resultInfo">Nextpulse</p>
    </div>
  </header>

  <main>
    <div class="results-container">
      <div class="results-card">
        <div class="results-icon" id="resultsIcon">
          <i class="fas fa-trophy"></i>
        </div>
        <h2 class="results-title" id="resultsTitle">Quiz Complete!</h2>
        <div class="results-score" id="resultsScore">0/0</div>
        <div class="results-percentage" id="resultsPercentage">0%</div>
        <div class="results-message" id="resultsMessage">
          Great job completing the quiz!
        </div>
        <div class="results-actions">
          <button class="action-btn primary" onclick="retryQuiz()">
            <i class="fas fa-redo"></i> Retry Quiz
          </button>
          <button class="action-btn secondary" onclick="goBack()">
            <i class="fas fa-arrow-left"></i> Back to Categories
          </button>
        </div>
      </div>

      <div class="review-list" id="reviewList">
        <h3 style="margin-bottom: 1rem; color: #2d3748;">Review Questions</h3>
      </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <a href="../../app.html"><i class="fas fa-lightbulb"></i><span>Home</span></a>
    <a href="../../00x1234.html"><i class="fas fa-play-circle"></i><span>Videos</span></a>
    <a href="../../search.html"><i class="fas fa-search"></i><span>Search</span></a>
    <a href="../index.html" class="active"><i class="fas fa-question-circle"></i><span>Q Bank</span></a>
  </nav>

  <script>
    let quizData = null;
    let folderName = '';
    let pathString = '';

    function goBack() {
      if (pathString) {
        window.location.href = `browse.html?path=${pathString}`;
      } else {
        window.location.href = 'index.html';
      }
    }

    function retryQuiz() {
      window.location.href = `quiz.html?folder=${encodeURIComponent(folderName)}&path=${pathString}`;
    }

    function loadResults() {
      const urlParams = new URLSearchParams(window.location.search);
      folderName = urlParams.get('folder') || '';
      pathString = urlParams.get('path') || '';
      const score = parseInt(urlParams.get('score')) || 0;
      const total = parseInt(urlParams.get('total')) || 0;

      document.getElementById('resultInfo').textContent = folderName;

      const percentage = total > 0 ? Math.round((score / total) * 100) : 0;
      
      document.getElementById('resultsScore').textContent = `${score}/${total}`;
      document.getElementById('resultsPercentage').textContent = `${percentage}%`;

      const iconElement = document.getElementById('resultsIcon');
      const titleElement = document.getElementById('resultsTitle');
      const messageElement = document.getElementById('resultsMessage');

      if (percentage >= 80) {
        iconElement.innerHTML = '<i class="fas fa-trophy"></i>';
        iconElement.className = 'results-icon good';
        titleElement.textContent = 'Excellent!';
        messageElement.textContent = 'Outstanding performance! You have mastered this topic.';
      } else if (percentage >= 60) {
        iconElement.innerHTML = '<i class="fas fa-medal"></i>';
        iconElement.className = 'results-icon average';
        titleElement.textContent = 'Good Job!';
        messageElement.textContent = 'Good effort! A bit more practice and you\'ll master this topic.';
      } else if (percentage >= 40) {
        iconElement.innerHTML = '<i class="fas fa-book-open"></i>';
        iconElement.className = 'results-icon average';
        titleElement.textContent = 'Keep Practicing!';
        messageElement.textContent = 'You\'re making progress. Review the explanations and try again.';
      } else {
        iconElement.innerHTML = '<i class="fas fa-book-reader"></i>';
        iconElement.className = 'results-icon poor';
        titleElement.textContent = 'Keep Learning!';
        messageElement.textContent = 'Don\'t give up! Review the material and try again.';
      }

      const savedResults = localStorage.getItem('quizResultsData');
      if (savedResults) {
        quizData = JSON.parse(savedResults);
        renderReviewList();
      }
    }

    function renderReviewList() {
      if (!quizData || !quizData.questions) return;

      const reviewList = document.getElementById('reviewList');
      const questionsHtml = quizData.questions.map((q, index) => {
        const userAnswer = quizData.userAnswers[index];
        const isCorrect = userAnswer === q.correct_answer;
        const statusClass = isCorrect ? 'correct' : 'incorrect';
        const statusIcon = isCorrect ? 'fa-check-circle' : 'fa-times-circle';

        return `
          <div class="review-item ${statusClass}" onclick="reviewQuestion(${index})">
            <span class="review-number">Q${index + 1}</span>
            <span class="review-status ${statusClass}">
              <i class="fas ${statusIcon}"></i>
            </span>
            <span style="flex: 1; color: #4a5568; font-size: 0.9rem;">
              ${q.question.substring(0, 50)}${q.question.length > 50 ? '...' : ''}
            </span>
          </div>
        `;
      }).join('');

      reviewList.innerHTML = `
        <h3 style="margin-bottom: 1rem; color: #2d3748;">Review Questions</h3>
        ${questionsHtml}
      `;
    }

    function reviewQuestion(index) {
      window.location.href = `quiz.html?folder=${encodeURIComponent(folderName)}&path=${pathString}&reviewMode=true&reviewIndex=${index}`;
    }

    window.addEventListener('load', loadResults);
  </script>
</body>
</html>
